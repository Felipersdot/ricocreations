{"ast":null,"code":"import _initializerDefineProperty from\"/Users/feliperodriguez/Desktop/Git Repos/ricocreations/node_modules/@babel/runtime/helpers/esm/initializerDefineProperty.js\";import _applyDecoratedDescriptor from\"/Users/feliperodriguez/Desktop/Git Repos/ricocreations/node_modules/@babel/runtime/helpers/esm/applyDecoratedDescriptor.js\";import _initializerWarningHelper from\"/Users/feliperodriguez/Desktop/Git Repos/ricocreations/node_modules/@babel/runtime/helpers/esm/initializerWarningHelper.js\";var _class,_descriptor,_descriptor2,_descriptor3,_descriptor4,_descriptor5,_descriptor6;import{StatusCodes}from'http-status-codes';import{observable,runInAction,action,makeAutoObservable}from'mobx';import jwt from'jsonwebtoken';import{TokenUtils}from'../utils/TokenUtils';import{Transport}from'../api/Transport';import userApi from'../api/userApi';import{User}from'../models/User';export let AuthStore=(_class=class AuthStore{constructor(){_initializerDefineProperty(this,\"error\",_descriptor,this);_initializerDefineProperty(this,\"isLoggedIn\",_descriptor2,this);_initializerDefineProperty(this,\"loggedInUser\",_descriptor3,this);_initializerDefineProperty(this,\"requireAuthorization\",_descriptor4,this);_initializerDefineProperty(this,\"logout\",_descriptor5,this);_initializerDefineProperty(this,\"setLoggedInUser\",_descriptor6,this);makeAutoObservable(this);this.isLoggedIn=!TokenUtils.isJwtTokenExpired();this.isLoggedIn&&this.setLoggedInUser();Transport.handleResponse(response=>response,error=>{const errors=error;if(errors.response){switch(errors.response.status){case StatusCodes.UNAUTHORIZED:this.logout();break;default:break;}}return Promise.reject(errors);});window.addEventListener('storage',()=>{if(TokenUtils.isJwtTokenExpired()){this.logout();}});}async login(email,password){try{const response=await userApi.auth.login(email,password);const authorizationHeader=response.headers.authorization;const token=authorizationHeader.substring('Bearer '.length,authorizationHeader.length);Transport.setJwtToken(token);const decodedToken=jwt.decode(token);if(decodedToken!==null){runInAction(()=>{this.loggedInUser=new User(decodedToken);this.isLoggedIn=true;this.error='';this.setRequireAuthorization(true);});}}catch(error){const errors=error;runInAction(()=>this.isLoggedIn=false);if(errors.response&&errors.response.status===StatusCodes.UNAUTHORIZED){runInAction(()=>{this.error=errors.response.data.error;});}else{console.error(error);}}return this.isLoggedIn;}setRequireAuthorization(requireAuthorization){this.requireAuthorization=requireAuthorization;}},(_descriptor=_applyDecoratedDescriptor(_class.prototype,\"error\",[observable],{configurable:true,enumerable:true,writable:true,initializer:function(){return'';}}),_descriptor2=_applyDecoratedDescriptor(_class.prototype,\"isLoggedIn\",[observable],{configurable:true,enumerable:true,writable:true,initializer:function(){return false;}}),_descriptor3=_applyDecoratedDescriptor(_class.prototype,\"loggedInUser\",[observable],{configurable:true,enumerable:true,writable:true,initializer:null}),_descriptor4=_applyDecoratedDescriptor(_class.prototype,\"requireAuthorization\",[observable],{configurable:true,enumerable:true,writable:true,initializer:function(){return false;}}),_descriptor5=_applyDecoratedDescriptor(_class.prototype,\"logout\",[action],{configurable:true,enumerable:true,writable:true,initializer:function(){return()=>{TokenUtils.removeJwtToken();this.isLoggedIn=false;this.setRequireAuthorization(false);};}}),_applyDecoratedDescriptor(_class.prototype,\"setRequireAuthorization\",[action],Object.getOwnPropertyDescriptor(_class.prototype,\"setRequireAuthorization\"),_class.prototype),_descriptor6=_applyDecoratedDescriptor(_class.prototype,\"setLoggedInUser\",[action],{configurable:true,enumerable:true,writable:true,initializer:function(){return()=>{Transport.setJwtToken(TokenUtils.getJwtTokenString());const decodedToken=jwt.decode(TokenUtils.getJwtTokenString());if(decodedToken!==null){this.loggedInUser=new User(decodedToken);this.isLoggedIn=true;this.error='';this.setRequireAuthorization(true);}};}})),_class);","map":{"version":3,"names":["StatusCodes","observable","runInAction","action","makeAutoObservable","jwt","TokenUtils","Transport","userApi","User","AuthStore","_class","constructor","_initializerDefineProperty","_descriptor","_descriptor2","_descriptor3","_descriptor4","_descriptor5","_descriptor6","isLoggedIn","isJwtTokenExpired","setLoggedInUser","handleResponse","response","error","errors","status","UNAUTHORIZED","logout","Promise","reject","window","addEventListener","login","email","password","auth","authorizationHeader","headers","authorization","token","substring","length","setJwtToken","decodedToken","decode","loggedInUser","setRequireAuthorization","data","console","requireAuthorization","_applyDecoratedDescriptor","prototype","configurable","enumerable","writable","initializer","removeJwtToken","Object","getOwnPropertyDescriptor","getJwtTokenString"],"sources":["/Users/feliperodriguez/Desktop/Git Repos/ricocreations/src/stores/AuthStore.ts"],"sourcesContent":["import { StatusCodes } from 'http-status-codes';\nimport { observable, runInAction, action, makeAutoObservable } from 'mobx';\nimport jwt from 'jsonwebtoken';\nimport { TokenUtils } from '../utils/TokenUtils';\nimport { Transport } from '../api/Transport';\nimport userApi from '../api/userApi';\nimport { DecodedToken, User } from '../models/User';\nimport { Error } from '../models/Error';\n\nexport class AuthStore {\n    @observable public error: string = '';\n    @observable public isLoggedIn: boolean = false;\n    @observable public loggedInUser: User;\n    @observable requireAuthorization: boolean = false;\n\n    constructor() {\n        makeAutoObservable(this);\n\n        this.isLoggedIn = !TokenUtils.isJwtTokenExpired();\n        this.isLoggedIn && this.setLoggedInUser();\n\n        Transport.handleResponse(\n            (response: any) => response,\n            (error: any) => {\n                const errors = error as Error;\n                if (errors.response) {\n                    switch (errors.response.status) {\n                        case StatusCodes.UNAUTHORIZED:\n                            this.logout();\n                            break;\n\n                        default:\n                            break;\n                    }\n                }\n                return Promise.reject(errors);\n            }\n        );\n        window.addEventListener('storage', () => {\n            if (TokenUtils.isJwtTokenExpired()) {\n                this.logout();\n            }\n        });\n    }\n\n    public async login(email: string, password: string): Promise<boolean> {\n        try {\n            const response = await userApi.auth.login(email, password);\n            const authorizationHeader = response.headers.authorization;\n            const token = authorizationHeader.substring('Bearer '.length, authorizationHeader.length);\n            Transport.setJwtToken(token);\n            const decodedToken = jwt.decode(token) as User;\n            if (decodedToken !== null) {\n                runInAction(() => {\n                    this.loggedInUser = new User(decodedToken);\n                    this.isLoggedIn = true;\n                    this.error = '';\n                    this.setRequireAuthorization(true);\n                });\n            }\n        } catch (error) {\n            const errors = error as Error;\n            runInAction(() => (this.isLoggedIn = false));\n            if (errors.response && errors.response.status === StatusCodes.UNAUTHORIZED) {\n                runInAction(() => {\n                    this.error = errors.response.data.error;\n                });\n            } else {\n                console.error(error);\n            }\n        }\n        return this.isLoggedIn;\n    }\n\n    @action public logout = () => {\n        TokenUtils.removeJwtToken();\n        this.isLoggedIn = false;\n        this.setRequireAuthorization(false);\n    };\n\n    @action public setRequireAuthorization(requireAuthorization: boolean) {\n        this.requireAuthorization = requireAuthorization;\n    }\n\n    @action public setLoggedInUser = () => {\n        Transport.setJwtToken(TokenUtils.getJwtTokenString()!);\n        const decodedToken = jwt.decode(TokenUtils.getJwtTokenString()!) as DecodedToken;\n        if (decodedToken !== null) {\n            this.loggedInUser = new User(decodedToken);\n            this.isLoggedIn = true;\n            this.error = '';\n            this.setRequireAuthorization(true);\n        }\n    };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}