{"ast":null,"code":"import _regeneratorRuntime from \"/Users/feliperodriguez/Desktop/Git Repos/ricocreations/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/feliperodriguez/Desktop/Git Repos/ricocreations/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _initializerDefineProperty from \"/Users/feliperodriguez/Desktop/Git Repos/ricocreations/node_modules/@babel/runtime/helpers/esm/initializerDefineProperty.js\";\nimport _classCallCheck from \"/Users/feliperodriguez/Desktop/Git Repos/ricocreations/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/feliperodriguez/Desktop/Git Repos/ricocreations/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _applyDecoratedDescriptor from \"/Users/feliperodriguez/Desktop/Git Repos/ricocreations/node_modules/@babel/runtime/helpers/esm/applyDecoratedDescriptor.js\";\nimport _initializerWarningHelper from \"/Users/feliperodriguez/Desktop/Git Repos/ricocreations/node_modules/@babel/runtime/helpers/esm/initializerWarningHelper.js\";\nvar _class, _descriptor, _descriptor2, _descriptor3, _descriptor4, _descriptor5, _descriptor6;\nimport { StatusCodes } from 'http-status-codes';\nimport { observable, runInAction, action, makeAutoObservable } from 'mobx';\nimport jwt from 'jsonwebtoken';\nimport { TokenUtils } from '../utils/TokenUtils';\nimport { Transport } from '../api/Transport';\nimport userApi from '../api/userApi';\nimport { User } from '../models/User';\nexport var AuthStore = (_class = /*#__PURE__*/function () {\n  function AuthStore() {\n    var _this = this;\n    _classCallCheck(this, AuthStore);\n    _initializerDefineProperty(this, \"error\", _descriptor, this);\n    _initializerDefineProperty(this, \"isLoggedIn\", _descriptor2, this);\n    _initializerDefineProperty(this, \"loggedInUser\", _descriptor3, this);\n    _initializerDefineProperty(this, \"requireAuthorization\", _descriptor4, this);\n    _initializerDefineProperty(this, \"logout\", _descriptor5, this);\n    _initializerDefineProperty(this, \"setLoggedInUser\", _descriptor6, this);\n    makeAutoObservable(this);\n    this.isLoggedIn = !TokenUtils.isJwtTokenExpired();\n    this.isLoggedIn && this.setLoggedInUser();\n    Transport.handleResponse(function (response) {\n      return response;\n    }, function (error) {\n      var errors = error;\n      if (errors.response) {\n        switch (errors.response.status) {\n          case StatusCodes.UNAUTHORIZED:\n            _this.logout();\n            break;\n          default:\n            break;\n        }\n      }\n      return Promise.reject(errors);\n    });\n    window.addEventListener('storage', function () {\n      if (TokenUtils.isJwtTokenExpired()) {\n        _this.logout();\n      }\n    });\n  }\n  return _createClass(AuthStore, [{\n    key: \"login\",\n    value: function () {\n      var _login = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(email, password) {\n        var _this2 = this;\n        var response, authorizationHeader, token, decodedToken, errors;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return userApi.auth.login(email, password);\n            case 3:\n              response = _context.sent;\n              authorizationHeader = response.headers.authorization;\n              token = authorizationHeader.substring('Bearer '.length, authorizationHeader.length);\n              Transport.setJwtToken(token);\n              decodedToken = jwt.decode(token);\n              if (decodedToken !== null) {\n                runInAction(function () {\n                  _this2.loggedInUser = new User(decodedToken);\n                  _this2.isLoggedIn = true;\n                  _this2.error = '';\n                  _this2.setRequireAuthorization(true);\n                });\n              }\n              _context.next = 16;\n              break;\n            case 11:\n              _context.prev = 11;\n              _context.t0 = _context[\"catch\"](0);\n              errors = _context.t0;\n              runInAction(function () {\n                return _this2.isLoggedIn = false;\n              });\n              if (errors.response && errors.response.status === StatusCodes.UNAUTHORIZED) {\n                runInAction(function () {\n                  _this2.error = errors.response.data.error;\n                });\n              } else {\n                console.error(_context.t0);\n              }\n            case 16:\n              return _context.abrupt(\"return\", this.isLoggedIn);\n            case 17:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this, [[0, 11]]);\n      }));\n      function login(_x, _x2) {\n        return _login.apply(this, arguments);\n      }\n      return login;\n    }()\n  }, {\n    key: \"setRequireAuthorization\",\n    value: function setRequireAuthorization(requireAuthorization) {\n      this.requireAuthorization = requireAuthorization;\n    }\n  }]);\n}(), (_descriptor = _applyDecoratedDescriptor(_class.prototype, \"error\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function initializer() {\n    return '';\n  }\n}), _descriptor2 = _applyDecoratedDescriptor(_class.prototype, \"isLoggedIn\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function initializer() {\n    return false;\n  }\n}), _descriptor3 = _applyDecoratedDescriptor(_class.prototype, \"loggedInUser\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor4 = _applyDecoratedDescriptor(_class.prototype, \"requireAuthorization\", [observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function initializer() {\n    return false;\n  }\n}), _descriptor5 = _applyDecoratedDescriptor(_class.prototype, \"logout\", [action], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function initializer() {\n    var _this3 = this;\n    return function () {\n      TokenUtils.removeJwtToken();\n      _this3.isLoggedIn = false;\n      _this3.setRequireAuthorization(false);\n    };\n  }\n}), _applyDecoratedDescriptor(_class.prototype, \"setRequireAuthorization\", [action], Object.getOwnPropertyDescriptor(_class.prototype, \"setRequireAuthorization\"), _class.prototype), _descriptor6 = _applyDecoratedDescriptor(_class.prototype, \"setLoggedInUser\", [action], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function initializer() {\n    var _this4 = this;\n    return function () {\n      Transport.setJwtToken(TokenUtils.getJwtTokenString());\n      var decodedToken = jwt.decode(TokenUtils.getJwtTokenString());\n      if (decodedToken !== null) {\n        _this4.loggedInUser = new User(decodedToken);\n        _this4.isLoggedIn = true;\n        _this4.error = '';\n        _this4.setRequireAuthorization(true);\n      }\n    };\n  }\n})), _class);","map":{"version":3,"names":["StatusCodes","observable","runInAction","action","makeAutoObservable","jwt","TokenUtils","Transport","userApi","User","AuthStore","_class","_this","_classCallCheck","_initializerDefineProperty","_descriptor","_descriptor2","_descriptor3","_descriptor4","_descriptor5","_descriptor6","isLoggedIn","isJwtTokenExpired","setLoggedInUser","handleResponse","response","error","errors","status","UNAUTHORIZED","logout","Promise","reject","window","addEventListener","_createClass","key","value","_login","_asyncToGenerator","_regeneratorRuntime","mark","_callee","email","password","_this2","authorizationHeader","token","decodedToken","wrap","_callee$","_context","prev","next","auth","login","sent","headers","authorization","substring","length","setJwtToken","decode","loggedInUser","setRequireAuthorization","t0","data","console","abrupt","stop","_x","_x2","apply","arguments","requireAuthorization","_applyDecoratedDescriptor","prototype","configurable","enumerable","writable","initializer","_this3","removeJwtToken","Object","getOwnPropertyDescriptor","_this4","getJwtTokenString"],"sources":["/Users/feliperodriguez/Desktop/Git Repos/ricocreations/src/stores/AuthStore.ts"],"sourcesContent":["import { StatusCodes } from 'http-status-codes';\nimport { observable, runInAction, action, makeAutoObservable } from 'mobx';\nimport jwt from 'jsonwebtoken';\nimport { TokenUtils } from '../utils/TokenUtils';\nimport { Transport } from '../api/Transport';\nimport userApi from '../api/userApi';\nimport { DecodedToken, User } from '../models/User';\nimport { Error } from '../models/Error';\n\nexport class AuthStore {\n    @observable public error: string = '';\n    @observable public isLoggedIn: boolean = false;\n    @observable public loggedInUser: User;\n    @observable requireAuthorization: boolean = false;\n\n    constructor() {\n        makeAutoObservable(this);\n\n        this.isLoggedIn = !TokenUtils.isJwtTokenExpired();\n        this.isLoggedIn && this.setLoggedInUser();\n\n        Transport.handleResponse(\n            (response: any) => response,\n            (error: any) => {\n                const errors = error as Error;\n                if (errors.response) {\n                    switch (errors.response.status) {\n                        case StatusCodes.UNAUTHORIZED:\n                            this.logout();\n                            break;\n\n                        default:\n                            break;\n                    }\n                }\n                return Promise.reject(errors);\n            }\n        );\n        window.addEventListener('storage', () => {\n            if (TokenUtils.isJwtTokenExpired()) {\n                this.logout();\n            }\n        });\n    }\n\n    public async login(email: string, password: string): Promise<boolean> {\n        try {\n            const response = await userApi.auth.login(email, password);\n            const authorizationHeader = response.headers.authorization;\n            const token = authorizationHeader.substring('Bearer '.length, authorizationHeader.length);\n            Transport.setJwtToken(token);\n            const decodedToken = jwt.decode(token) as User;\n            if (decodedToken !== null) {\n                runInAction(() => {\n                    this.loggedInUser = new User(decodedToken);\n                    this.isLoggedIn = true;\n                    this.error = '';\n                    this.setRequireAuthorization(true);\n                });\n            }\n        } catch (error) {\n            const errors = error as Error;\n            runInAction(() => (this.isLoggedIn = false));\n            if (errors.response && errors.response.status === StatusCodes.UNAUTHORIZED) {\n                runInAction(() => {\n                    this.error = errors.response.data.error;\n                });\n            } else {\n                console.error(error);\n            }\n        }\n        return this.isLoggedIn;\n    }\n\n    @action public logout = () => {\n        TokenUtils.removeJwtToken();\n        this.isLoggedIn = false;\n        this.setRequireAuthorization(false);\n    };\n\n    @action public setRequireAuthorization(requireAuthorization: boolean) {\n        this.requireAuthorization = requireAuthorization;\n    }\n\n    @action public setLoggedInUser = () => {\n        Transport.setJwtToken(TokenUtils.getJwtTokenString()!);\n        const decodedToken = jwt.decode(TokenUtils.getJwtTokenString()!) as DecodedToken;\n        if (decodedToken !== null) {\n            this.loggedInUser = new User(decodedToken);\n            this.isLoggedIn = true;\n            this.error = '';\n            this.setRequireAuthorization(true);\n        }\n    };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}